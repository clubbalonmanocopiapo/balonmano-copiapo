<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Club Deportivo Balonmano Copiapó</title>
  <meta name="description" content="Sitio oficial del Club Deportivo Balonmano Copiapó: fotos, inscripciones, pagos, estadísticas y noticias." />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root{
      --bg:#0b1220;
      --card:#0f1b2f;
      --muted:#9bb0d1;
      --text:#eaf1ff;
      --brand:#2f7cff;
      --brand2:#00d4ff;
      --ok:#23c483;
      --warn:#ffcc66;
      --border:rgba(255,255,255,.08);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 18px;
      --max: 1120px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:linear-gradient(180deg,#081021, #060b15 60%);color:var(--text);font-family:Inter,system-ui,Segoe UI,Arial}
    a{color:inherit}
    .container{max-width:var(--max);margin:0 auto;padding:0 18px}
    header{
      position:sticky;top:0;z-index:50;
      background:rgba(6,11,21,.75);
      backdrop-filter: blur(10px);
      border-bottom:1px solid var(--border);
    }
    .nav{
      display:flex;align-items:center;justify-content:space-between;
      padding:14px 0;
      gap:14px;
    }
    .brand{
      display:flex;align-items:center;gap:10px;text-decoration:none;
      font-weight:800;letter-spacing:.2px;
    }
    .logo{
      width:38px;height:38px;border-radius:12px;
      background: radial-gradient(circle at 20% 20%, var(--brand2), var(--brand));
      box-shadow:0 10px 25px rgba(47,124,255,.25);
      display:grid;place-items:center;
      font-weight:900;
    }
    .brand small{display:block;color:var(--muted);font-weight:600;letter-spacing:0}
    .links{display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end}
    .links a{
      text-decoration:none;
      padding:10px 12px;border:1px solid var(--border);
      border-radius:999px;color:var(--muted);
      transition:.2s;
      font-weight:600;
      font-size:13px;
    }
    .links a:hover{border-color:rgba(47,124,255,.45);color:var(--text);transform:translateY(-1px)}
    .cta{
      background:linear-gradient(90deg,var(--brand),var(--brand2));
      color:#051021 !important;border:none !important;
    }

    .hero{ padding:42px 0 26px; }
    .hero-grid{
      display:grid;grid-template-columns:1.25fr .75fr;gap:18px;
      align-items:stretch;
    }
    .hero-card{
      background:linear-gradient(180deg, rgba(47,124,255,.18), rgba(15,27,47,.85));
      border:1px solid rgba(47,124,255,.25);
      border-radius:var(--radius);
      box-shadow: var(--shadow);
      padding:22px;
      overflow:hidden;
      position:relative;
    }
    .hero-card:before{
      content:"";
      position:absolute;inset:-40px;
      background: radial-gradient(circle at 30% 20%, rgba(0,212,255,.25), transparent 55%),
                  radial-gradient(circle at 80% 60%, rgba(47,124,255,.25), transparent 55%);
      pointer-events:none;
    }
    .hero-card > *{position:relative}
    h1{margin:0 0 10px;font-size:34px;line-height:1.1}
    .sub{color:var(--muted);margin:0 0 18px;max-width:55ch}
    .badges{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .badge{
      border:1px solid var(--border);
      background:rgba(255,255,255,.03);
      padding:8px 10px;border-radius:999px;
      color:var(--muted);
      font-weight:600;font-size:13px;
    }

    .hero-side{
      background:rgba(15,27,47,.75);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow: var(--shadow);
      padding:18px;
      display:flex;flex-direction:column;justify-content:space-between;
      gap:14px;
    }
    .quick{ display:grid;gap:10px; }
    .quick .item{
      border:1px solid var(--border);
      background:rgba(255,255,255,.03);
      border-radius:14px;
      padding:12px;
    }
    .item strong{display:block;margin-bottom:4px}
    .item span{color:var(--muted);font-size:13px}
    .btnrow{display:flex;gap:10px;flex-wrap:wrap}
    .btn{
      text-decoration:none;display:inline-flex;align-items:center;justify-content:center;
      padding:10px 12px;border-radius:12px;
      border:1px solid var(--border);
      color:var(--text);
      font-weight:700;
      transition:.2s;
      background:rgba(255,255,255,.03);
      cursor:pointer;
    }
    .btn:hover{transform:translateY(-1px);border-color:rgba(47,124,255,.35)}
    .btn.primary{
      background:linear-gradient(90deg,var(--brand),var(--brand2));
      color:#051021;border:none;
    }

    section{padding:26px 0}
    .section-title{
      display:flex;align-items:flex-end;justify-content:space-between;gap:14px;
      margin-bottom:12px
    }
    .section-title h2{margin:0;font-size:22px}
    .section-title p{margin:0;color:var(--muted);font-size:13px;max-width:70ch}

    .grid{
      display:grid;gap:14px;
      grid-template-columns: repeat(12, 1fr);
    }
    .card{
      grid-column:span 12;
      background:rgba(15,27,47,.75);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow: var(--shadow);
      padding:16px;
    }

    .gallery{
      display:grid;
      grid-template-columns:repeat(12,1fr);
      gap:10px;
    }
    .ph{
      grid-column:span 4;
      border-radius:16px;
      border:1px solid var(--border);
      overflow:hidden;
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      min-height:140px;
      position:relative;
      cursor:pointer;
    }
    .ph .cap{
      position:absolute;left:10px;bottom:10px;
      padding:6px 10px;border-radius:999px;
      background:rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.12);
      font-size:12px;color:var(--text);
      backdrop-filter: blur(8px);
    }
    .ph img{
      width:100%;
      height:100%;
      min-height:140px;
      object-fit:cover;
      display:block;
      background:rgba(0,0,0,.12);
    }

    form{display:grid;gap:10px}
    .row{display:grid;gap:10px;grid-template-columns:repeat(12,1fr)}
    .col6{grid-column:span 6}
    .col4{grid-column:span 4}
    .col8{grid-column:span 8}
    .col12{grid-column:span 12}
    label{font-size:13px;color:var(--muted);font-weight:600}
    input,select,textarea{
      width:100%;
      background:rgba(255,255,255,.03);
      border:1px solid var(--border);
      border-radius:12px;
      padding:11px 12px;
      color:var(--text);
      outline:none;
      font:inherit;
    }
    textarea{min-height:100px;resize:vertical}
    input:focus,select:focus,textarea:focus{border-color:rgba(47,124,255,.55)}
    .hint{color:var(--muted);font-size:12px}

    .paybox{
      display:grid;gap:10px;
      grid-template-columns:repeat(12,1fr);
      align-items:start;
    }
    .bank{grid-column:span 7}
    .upload{grid-column:span 5}
    .kv{
      display:grid;gap:8px;margin-top:10px
    }
    .kv div{
      display:flex;justify-content:space-between;gap:10px;
      border:1px dashed rgba(255,255,255,.15);
      border-radius:12px;padding:10px;background:rgba(255,255,255,.02)
    }
    .kv b{color:var(--text)}
    .kv span{color:var(--muted);text-align:right}
    .copy{
      margin-top:10px;display:flex;gap:10px;flex-wrap:wrap
    }

    .news{
      display:grid;gap:12px;
      grid-template-columns:repeat(12,1fr);
    }
    .news .n{
      grid-column:span 4;
      padding:14px;
      border-radius:16px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.03);
      transition:.2s;
    }
    .news .n:hover{transform:translateY(-2px);border-color:rgba(47,124,255,.35)}
    .tag{
      display:inline-flex;gap:8px;align-items:center;
      font-size:12px;
      color:#051021;
      background:linear-gradient(90deg,var(--warn), #ffd89a);
      padding:6px 10px;border-radius:999px;
      font-weight:800;
    }
    .meta{color:var(--muted);font-size:12px;margin-top:8px}
    .n h3{margin:10px 0 6px;font-size:16px}
    .n p{margin:0;color:var(--muted);font-size:13px;line-height:1.5}

    footer{
      padding:20px 0 34px;
      border-top:1px solid var(--border);
      color:var(--muted);
      font-size:13px;
    }
    .foot{
      display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:space-between
    }

    @media (max-width: 980px){
      .hero-grid{grid-template-columns:1fr}
      .ph{grid-column:span 6}
      .news .n{grid-column:span 6}
      .bank{grid-column:span 12}
      .upload{grid-column:span 12}
    }
    @media (max-width: 640px){
      h1{font-size:28px}
      .links{display:none}
      .ph{grid-column:span 12}
      .news .n{grid-column:span 12}
      .col6,.col4,.col8{grid-column:span 12}
    }

    .bm-modal{
      display:none;
      position:fixed; inset:0;
      z-index:9999;
    }
    .bm-modal.show{ display:block; }
    .bm-modal-backdrop{
      position:absolute; inset:0;
      background:rgba(0,0,0,.65);
      backdrop-filter: blur(8px);
    }
    .bm-modal-panel{
      position:relative;
      width:min(980px, calc(100% - 22px));
      margin:22px auto;
      background:rgba(15,27,47,.92);
      border:1px solid rgba(255,255,255,.10);
      border-radius:18px;
      box-shadow: 0 20px 60px rgba(0,0,0,.55);
      padding:14px;
      max-height: calc(100vh - 44px);
      overflow:auto;
    }
    .bm-modal-head{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:6px 6px 10px;
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .bm-modal-grid{
      display:grid;
      grid-template-columns:repeat(12,1fr);
      gap:10px;
      padding:12px 6px 6px;
    }
    .bm-modal-item{
      grid-column:span 4;
      border-radius:16px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.08);
      background:rgba(255,255,255,.03);
      position:relative;
    }
    .bm-modal-item img{
      width:100%;
      height:190px;
      object-fit:cover;
      display:block;
      background:rgba(0,0,0,.12);
    }
    .bm-modal-cap{
      position:absolute;left:10px;bottom:10px;
      padding:6px 10px;border-radius:999px;
      background:rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.12);
      font-size:12px;color:var(--text);
      backdrop-filter: blur(8px);
    }
    @media(max-width: 980px){ .bm-modal-item{ grid-column:span 6; } }
    @media(max-width: 640px){ .bm-modal-item{ grid-column:span 12; } }
  </style>
</head>

<body>
<header>
  <div class="container nav">
    <a class="brand" href="#inicio">
      <div class="logo">BM</div>
      <div>
        Club Deportivo Balonmano Copiapó
        <small>Fotos · Inscripción · Pagos · Estadísticas · Noticias</small>
      </div>
    </a>

    <nav class="links" aria-label="Navegación principal">
      <a href="#fotos">Fotos</a>
      <a href="#unete">Únete</a>
      <a href="#pagos">Pagos</a>
      <a href="#estadisticas">Estadísticas</a>
      <a href="#noticias">Noticias</a>
      <a class="cta" href="#unete">Inscribirse</a>
    </nav>
  </div>
</header>

<main id="inicio" class="container">
  <section class="hero">
    <div class="hero-grid">
      <div class="hero-card">
        <h1>Pasión, disciplina y comunidad en Copiapó</h1>
        <p class="sub">
          Sitio oficial del club: comparte nuestros logros, revisa estadísticas, entérate de campeonatos,
          y únete al equipo.
        </p>
        <div class="btnrow">
          <a class="btn primary" href="#unete">Quiero unirme</a>
          <a class="btn" href="#pagos">Pagar mensualidad</a>
          <a class="btn" href="#noticias">Ver noticias</a>
        </div>
        <div class="badges">
          <div class="badge">Entrenamientos: <b>Martes & Jueves</b></div>
          <div class="badge">Categorías: <b>Formativas · Adultos</b></div>
          <div class="badge">Ciudad: <b>Copiapó</b></div>
        </div>
      </div>

      <aside class="hero-side">
        <div class="quick">
          <div class="item">
            <strong>Contacto</strong>
            <span>WhatsApp / Instagram / Correo del club</span>
          </div>
          <div class="item">
            <strong>Próximo evento</strong>
            <span>Agrega aquí el próximo campeonato o amistoso</span>
          </div>
          <div class="item">
            <strong>Último resultado</strong>
            <span>Completa el último marcador destacado</span>
          </div>
        </div>
        <div class="btnrow">
          <button class="btn" id="btnScrollFotos">Ver fotos</button>
          <button class="btn" id="btnScrollStats">Ver estadísticas</button>
        </div>
      </aside>
    </div>
  </section>

  <section id="fotos">
    <div class="section-title">
      <div>
        <h2>Fotos del club</h2>
        <p>En “Entrenamiento” se muestra 1 foto y al hacer click se cargan TODAS las fotos de la carpeta de entrenamientos en Drive.</p>
      </div>
      <div class="hint">Drive</div>
    </div>

    <div class="card">
      <div class="gallery">
        <div class="ph" id="bmTrainingOpen" title="Click para ver galería de Entrenamientos">
          <img id="bmTrainingCover" alt="Entrenamiento" referrerpolicy="no-referrer">
          <div class="cap">Entrenamiento</div>
        </div>

        <div class="ph"><div class="cap">Campeonato</div></div>
        <div class="ph"><div class="cap">Equipo</div></div>
        <div class="ph"><div class="cap">Infantil</div></div>
        <div class="ph"><div class="cap">Juvenil</div></div>
        <div class="ph"><div class="cap">Adultos</div></div>
      </div>

      <p class="hint" id="bmTrainStatus" style="margin:12px 0 0"></p>
    </div>
  </section>

  <!-- (resto de secciones sin cambios) -->
  <!-- ÚNETE -->
  <section id="unete"> ... </section>
  <section id="pagos"> ... </section>
  <section id="estadisticas"> ... </section>
  <section id="noticias"> ... </section>
</main>

<footer>
  <div class="container foot">
    <div>
      <b>Club Deportivo Balonmano Copiapó</b><br/>
      <span>© <span id="year"></span> · Todos los derechos reservados</span>
    </div>
    <div class="hint">Desarrollado en HTML + CSS + JS</div>
  </div>
</footer>

<div class="bm-modal" id="bmTrainingModal" aria-hidden="true">
  <div class="bm-modal-backdrop" id="bmTrainingClose"></div>
  <div class="bm-modal-panel" role="dialog" aria-modal="true" aria-label="Galería Entrenamientos">
    <div class="bm-modal-head">
      <div>
        <strong>Entrenamientos</strong><br>
        <span class="hint">Fotos alojadas en Google Drive</span>
      </div>
      <button class="btn" type="button" id="bmTrainingCloseBtn">Cerrar ✕</button>
    </div>

    <div class="bm-modal-grid" id="bmTrainingGrid"></div>
  </div>
</div>

<script>
  const CLUB = {
    banco: "Banco Estado",
    tipo: "Cuenta Corriente",
    cuenta: "12.345.678",
    rut: "12.345.678-9",
    nombreCuenta: "Club Deportivo Balonmano Copiapó",
    correoCuenta: "pagos@tudominio.cl",
    glosa: "Mensualidad + Nombre jugador/a",
    mensualidad: 15000
  };

  const STATS = {
    season: "2025",
    played: 12,
    won: 8,
    drawn: 1,
    lost: 3,
    goalsFor: 312,
    goalsAgainst: 280
  };

  const driveThumb = (id, w=1200) => `https://drive.google.com/thumbnail?id=${id}&sz=w${w}`;

  const TRAINING_FOLDER_ID = "1JUYI3iNdqDtjzRL4_12ZylY6A3opvip1";
  const TRAINING_FEED_URL = "https://script.google.com/macros/s/AKfycbzsQsPSvodg5KD4RASU2TWUzvYl-yIsvBcSjdjG91mlgRDEMlhZLZ3qdBkjiAVyd2u7/exec";

  const bmTrainStatus = document.getElementById("bmTrainStatus");
  const bmTrainingCover = document.getElementById("bmTrainingCover");
  const bmTrainingOpen = document.getElementById("bmTrainingOpen");
  const bmTrainingModal = document.getElementById("bmTrainingModal");
  const bmTrainingClose = document.getElementById("bmTrainingClose");
  const bmTrainingCloseBtn = document.getElementById("bmTrainingCloseBtn");
  const bmTrainingGrid = document.getElementById("bmTrainingGrid");

  let TRAINING_PHOTOS = [];

  // ====== JSONP helper (soluciona CORS en GitHub Pages) ======
  function jsonp(url, callbackName) {
    return new Promise((resolve, reject) => {
      const script = document.createElement("script");
      const timeout = setTimeout(() => {
        cleanup();
        reject(new Error("JSONP timeout"));
      }, 15000);

      function cleanup() {
        clearTimeout(timeout);
        script.remove();
        try { delete window[callbackName]; } catch(e) { window[callbackName] = undefined; }
      }

      window[callbackName] = (data) => {
        cleanup();
        resolve(data);
      };

      script.src = url;
      script.onerror = () => {
        cleanup();
        reject(new Error("JSONP load error"));
      };

      document.body.appendChild(script);
    });
  }

  async function loadTrainingFromDriveFolder(){
    const cb = "bm_cb_" + Math.random().toString(36).slice(2);
    const url = `${TRAINING_FEED_URL}?folder=${encodeURIComponent(TRAINING_FOLDER_ID)}&callback=${cb}`;

    bmTrainStatus.textContent = "Cargando fotos de entrenamientos…";

    try{
      const data = await jsonp(url, cb);

      if (!Array.isArray(data) || data.length === 0) {
        TRAINING_PHOTOS = [];
        bmTrainingCover.removeAttribute("src");
        bmTrainStatus.textContent = "No se encontraron fotos en la carpeta (o permisos).";
        return;
      }

      TRAINING_PHOTOS = data.map((x, i) => ({
        id: x.id,
        title: (x.name ? x.name : `Entrenamiento ${i+1}`).replace(/\.[^/.]+$/, "")
      }));

      bmTrainingCover.src = driveThumb(TRAINING_PHOTOS[0].id, 1200);
      bmTrainingCover.referrerPolicy = "no-referrer";

      bmTrainStatus.textContent = `Listo ✅ ${TRAINING_PHOTOS.length} fotos cargadas. (Click en “Entrenamiento” para ver todas)`;
    }catch(err){
      console.error(err);
      bmTrainStatus.textContent = "Error cargando Drive. Revisa que actualizaste el Apps Script con callback y re-implementaste como 'Cualquiera'.";
    }
  }

  function bmRenderTraining(){
    bmTrainingGrid.innerHTML = "";

    if (!TRAINING_PHOTOS.length) {
      bmTrainingGrid.innerHTML = `<div class="hint" style="padding:10px">No hay fotos para mostrar. Revisa permisos y recarga.</div>`;
      return;
    }

    TRAINING_PHOTOS.forEach((p)=>{
      const div = document.createElement("div");
      div.className = "bm-modal-item";
      div.innerHTML = `
        <img alt="${p.title}" loading="lazy" referrerpolicy="no-referrer">
        <div class="bm-modal-cap">${p.title}</div>
      `;
      div.querySelector("img").src = driveThumb(p.id, 1200);
      bmTrainingGrid.appendChild(div);
    });
  }

  function bmOpenTraining(){
    bmTrainingModal.classList.add("show");
    bmTrainingModal.setAttribute("aria-hidden","false");
    document.body.style.overflow = "hidden";
    bmRenderTraining();
  }
  function bmCloseTraining(){
    bmTrainingModal.classList.remove("show");
    bmTrainingModal.setAttribute("aria-hidden","true");
    document.body.style.overflow = "";
  }

  bmTrainingOpen.addEventListener("click", bmOpenTraining);
  bmTrainingClose.addEventListener("click", bmCloseTraining);
  bmTrainingCloseBtn.addEventListener("click", bmCloseTraining);
  document.addEventListener("keydown", (e)=>{ if(e.key==="Escape" && bmTrainingModal.classList.contains("show")) bmCloseTraining(); });

  const setText = (id, v) => document.getElementById(id).textContent = v;
  // (tu resto de JS igual, lo dejo tal como lo tienes si está en tu archivo)
  document.getElementById("year").textContent = new Date().getFullYear();

  // INIT
  loadTrainingFromDriveFolder();
</script>
</body>
</html>
